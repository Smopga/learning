<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Mathe Pro</title>
<style>
body{margin:0;font-family:system-ui,sans-serif;background:#0f1220;color:#fff;padding:20px}
h1{text-align:center}
.panel{background:#1c1f3a;padding:15px;border-radius:14px;margin-bottom:15px}
.options{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:8px}
label{background:#2a2e5a;padding:10px;border-radius:10px;cursor:pointer}
label input{margin-right:6px}
.task{font-size:24px;text-align:center;margin:20px 0}
.answer,.fraction-input{width:100%;padding:12px;font-size:18px;border-radius:10px;border:none}
button{width:100%;margin-top:10px;padding:14px;font-size:18px;border:none;border-radius:12px;background:#4cafef;color:black;cursor:pointer}
.status,.score{text-align:center;margin-top:8px}
#circleCanvas{display:block;margin:20px auto;background:#1c1f3a;border-radius:50%}

/* Shake */
@keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-6px)}50%{transform:translateX(6px)}75%{transform:translateX(-6px)}100%{transform:translateX(0)}}
.shake{animation:shake .25s}

/* Confetti */
.confetti{position:fixed;width:8px;height:8px;top:-10px;animation:fall .25s linear forwards}
@keyframes fall{to{transform:translateY(110vh) rotate(360deg);opacity:0}}
</style>
</head>
<body>

<h1>üßÆ Mathe Pro</h1>

<div class="panel">
<select id="difficulty" class="answer">
<option value="1">1. Klasse</option>
<option value="2">2. Klasse</option>
<option value="3">3. Klasse</option>
<option value="4">4‚Äì6 Klasse</option>
<option value="5">7‚Äì9 Klasse</option>
<option value="6">10‚Äì12 Klasse</option>
<option value="7">Berufsschule leicht</option>
<option value="8">Berufsschule mittel</option>
<option value="9">Berufsschule schwer</option>
<option value="10">Profi</option>
</select>
</div>

<div class="panel">
<div class="options">
<label><input type="checkbox" id="add" checked> Addition</label>
<label><input type="checkbox" id="sub" checked> Subtraktion</label>
<label><input type="checkbox" id="mul" checked> Multiplikation</label>
<label><input type="checkbox" id="div"> Division</label>
<label><input type="checkbox" id="brackets" checked> Klammern</label>
<label><input type="checkbox" id="chain"> Kettenaufgabe</label>
<label><input type="checkbox" id="fraction"> Br√ºche</label>
<label><input type="checkbox" id="circle"> Kreise</label>
</div>
</div>

<div class="panel">
<div class="task" id="task">Neue Aufgabe</div>

<div id="fractionInputs" style="display:none">
<input type="number" id="fracNum" class="fraction-input" placeholder="Z√§hler">
<input type="number" id="fracDen" class="fraction-input" placeholder="Nenner">
</div>

<canvas id="circleCanvas" width="250" height="250" style="display:none"></canvas>

<input id="answer" class="answer">
<button onclick="check()">Antwort pr√ºfen</button>

<div class="status" id="status"></div>
<div class="score">Punkte: <span id="score">0</span></div>
</div>

<script>
let score=0, solution=0
const taskEl=document.getElementById("task")
const answerEl=document.getElementById("answer")
const statusEl=document.getElementById("status")
const fracInputs=document.getElementById("fractionInputs")
const fracNum=document.getElementById("fracNum")
const fracDen=document.getElementById("fracDen")
const circleCanvas=document.getElementById("circleCanvas")
const ctx=circleCanvas.getContext("2d")

function r(max){return Math.floor(Math.random()*max)+1}

/* ----- TOLERANZ FIX ----- */
function isCorrectNumber(user,sol){
return Math.abs(Number(user)-sol)<0.01
}

function gcd(a,b){return b===0?a:gcd(b,a%b)}
function isCorrectFraction(num,den,sol){
const g=gcd(num,den)
num/=g;den/=g
const g2=gcd(sol.num,sol.den)
const solNum=sol.num/g2
const solDen=sol.den/g2
return num===solNum && den===solDen
}

/* ----- Effekte ----- */
function party(){
for(let i=0;i<20;i++){
const c=document.createElement("div")
c.className="confetti"
c.style.left=Math.random()*100+"vw"
c.style.background=`hsl(${Math.random()*360},80%,60%)`
document.body.appendChild(c)
setTimeout(()=>c.remove(),300)
}
}

function shake(){
document.body.classList.add("shake")
setTimeout(()=>document.body.classList.remove("shake"),250)
}

/* ----- Neue Aufgabe ----- */
function newTask(){

fracInputs.style.display="none"
circleCanvas.style.display="none"
answerEl.style.display="block"
answerEl.value=""
statusEl.textContent=""

if(fraction.checked){
let num=r(10)
let den=r(9)+1
solution={num:num,den:den}
taskEl.textContent=`Vereinfache: ${num}/${den}`
fracInputs.style.display="block"
answerEl.style.display="none"
return
}

if(circle.checked){
let radius=r(50)+20
solution=radius*2
taskEl.textContent=`Durchmesser? (Radius=${radius})`
circleCanvas.style.display="block"
ctx.clearRect(0,0,250,250)
ctx.beginPath()
ctx.arc(125,125,radius,0,2*Math.PI)
ctx.fillStyle="#4cafef33"
ctx.fill()
ctx.strokeStyle="#4cafef"
ctx.lineWidth=3
ctx.stroke()
return
}

let types=[]
if(add.checked)types.push("+")
if(sub.checked)types.push("-")
if(mul.checked)types.push("*")
if(div.checked)types.push("/")

if(types.length===0){taskEl.textContent="Typ w√§hlen";return}

let partCount=chain.checked?2+Math.floor(Math.random()*2):1
let expr=""

for(let i=0;i<partCount;i++){
let a=r(50)
let b=r(50)
let op=types[Math.floor(Math.random()*types.length)]
let part=`${a} ${op} ${b}`
if(brackets.checked && Math.random()>0.5){
let c=r(30)
part=`(${part}) ${op} ${c}`
}
expr+=expr==""?part:` ${op} ${part}`
}

solution=Math.round(eval(expr)*100)/100
taskEl.textContent=expr
}

/* ----- Check ----- */
function check(){

if(fraction.checked){
if(isCorrectFraction(Number(fracNum.value),Number(fracDen.value),solution)){
score+=5
statusEl.textContent="‚úÖ Richtig!"
party()
setTimeout(newTask,250)
}else{
score-=10
statusEl.textContent=`‚ùå Falsch! L√∂sung: ${solution.num}/${solution.den}`
shake()
}
}
else{
if(isCorrectNumber(answerEl.value,solution)){
score+=5
statusEl.textContent="‚úÖ Richtig!"
party()
setTimeout(newTask,250)
}else{
score-=10
statusEl.textContent=`‚ùå Falsch! L√∂sung: ${solution}`
shake()
}
}

document.getElementById("score").textContent=score
}

newTask()
</script>

</body>
</html>
