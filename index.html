<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Buchstaben Nachspuren</title>
<style>
    body {
        font-family: system-ui, -apple-system, sans-serif;
        text-align: center;
        background: #f5f5f5;
        margin: 0;
        padding: 20px;
    }

    canvas {
        background: white;
        border: 2px solid #333;
        touch-action: none;
        margin-top: 10px;
    }

    button {
        font-size: 16px;
        padding: 10px 16px;
        margin: 8px;
    }

    #result {
        font-size: 18px;
        margin-top: 10px;
    }
</style>
</head>
<body>

<h2>Nachspuren mit links ✍️</h2>

<canvas id="canvas" width="300" height="300"></canvas>

<div>
    <button onclick="resetCanvas()">Reset</button>
    <button onclick="checkAccuracy()">Check</button>
</div>

<div id="result">Accuracy: –</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let drawing = false;

// Zielbuchstabe
const letter = "A";

// Zeichne Vorlage
function drawTemplate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.globalAlpha = 0.2;
    ctx.font = "220px Arial";
    ctx.fillStyle = "black";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(letter, canvas.width / 2, canvas.height / 2);
    ctx.globalAlpha = 1;
}

drawTemplate();

// Zeichnen
canvas.addEventListener("pointerdown", e => {
    drawing = true;
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
});

canvas.addEventListener("pointermove", e => {
    if (!drawing) return;
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.strokeStyle = "black";
    ctx.lineWidth = 12;
    ctx.lineCap = "round";
    ctx.stroke();
});

canvas.addEventListener("pointerup", () => drawing = false);
canvas.addEventListener("pointerleave", () => drawing = false);

// Reset
function resetCanvas() {
    drawTemplate();
    document.getElementById("result").textContent = "Accuracy: –";
}

// Accuracy prüfen
function checkAccuracy() {
    // Offscreen Canvas für Vorlage
    const temp = document.createElement("canvas");
    temp.width = canvas.width;
    temp.height = canvas.height;
    const tctx = temp.getContext("2d");

    tctx.font = "220px Arial";
    tctx.textAlign = "center";
    tctx.textBaseline = "middle";
    tctx.fillText(letter, canvas.width / 2, canvas.height / 2);

    const drawn = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
    const target = tctx.getImageData(0, 0, canvas.width, canvas.height).data;

    let match = 0;
    let total = 0;

    for (let i = 0; i < drawn.length; i += 4) {
        const d = drawn[i + 3] > 50;
        const t = target[i + 3] > 50;

        if (t) {
            total++;
            if (d) match++;
        }
    }

    let accuracy = total === 0 ? 0 : Math.round((match / total) * 100);

    let text = "Accuracy: " + accuracy + "%";
    if (accuracy > 60) text += " ✅ erkannt";
    else text += " ❌ zu ungenau";

    document.getElementById("result").textContent = text;
}
</script>

</body>
</html>
