<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Buchstaben Nachspuren</title>

<style>
body {
    font-family: system-ui, -apple-system, sans-serif;
    background: #f2f2f2;
    text-align: center;
    margin: 0;
    padding: 15px;
}

#menu {
    margin-bottom: 10px;
}

select, button {
    font-size: 16px;
    padding: 6px;
    margin: 4px;
}

canvas {
    background: white;
    border: 2px solid #222;
    touch-action: none;
}
#result {
    margin-top: 10px;
    font-size: 18px;
}
</style>
</head>

<body>

<h3>Nachspuren ‚úçÔ∏è</h3>

<div id="menu">
    <select id="letterSelect"></select>

    <select id="caseSelect">
        <option value="upper">Gro√ü</option>
        <option value="lower">Klein</option>
    </select>

    <button onclick="resetCanvas()">Reset</button>
    <button onclick="checkAccuracy()">Check</button>
</div>

<canvas id="canvas" width="320" height="320"></canvas>

<div id="result">Accuracy: ‚Äì</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let drawing = false;

// Buchstabenmen√º f√ºllen
const letterSelect = document.getElementById("letterSelect");
for (let i = 65; i <= 90; i++) {
    letterSelect.innerHTML += `<option>${String.fromCharCode(i)}</option>`;
}

letterSelect.value = "A";

document.getElementById("caseSelect").addEventListener("change", drawTemplate);
letterSelect.addEventListener("change", drawTemplate);

// Vorlage zeichnen
function drawTemplate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const letter = letterSelect.value;
    const isUpper = document.getElementById("caseSelect").value === "upper";
    const char = isUpper ? letter : letter.toLowerCase();

    ctx.globalAlpha = 0.18;
    ctx.font = "230px Arial";
    ctx.fillStyle = "black";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(char, canvas.width / 2, canvas.height / 2);
    ctx.globalAlpha = 1;
}

drawTemplate();

// Zeichnen
canvas.addEventListener("pointerdown", e => {
    drawing = true;
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
});

canvas.addEventListener("pointermove", e => {
    if (!drawing) return;
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.strokeStyle = "black";
    ctx.lineWidth = 12;
    ctx.lineCap = "round";
    ctx.stroke();
});

canvas.addEventListener("pointerup", () => drawing = false);
canvas.addEventListener("pointerleave", () => drawing = false);

// Reset
function resetCanvas() {
    drawTemplate();
    document.getElementById("result").textContent = "Accuracy: ‚Äì";
}

// Genauere Erkennung
function checkAccuracy() {
    const off = document.createElement("canvas");
    off.width = canvas.width;
    off.height = canvas.height;
    const octx = off.getContext("2d");

    const letter = letterSelect.value;
    const isUpper = document.getElementById("caseSelect").value === "upper";
    const char = isUpper ? letter : letter.toLowerCase();

    octx.font = "230px Arial";
    octx.textAlign = "center";
    octx.textBaseline = "middle";
    octx.fillText(char, canvas.width / 2, canvas.height / 2);

    const drawn = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
    const target = octx.getImageData(0, 0, canvas.width, canvas.height).data;

    let hit = 0;
    let miss = 0;
    let totalTarget = 0;

    for (let i = 0; i < drawn.length; i += 4) {
        const d = drawn[i + 3] > 40;
        const t = target[i + 3] > 40;

        if (t) {
            totalTarget++;
            if (d) hit++;
        } else {
            if (d) miss++;
        }
    }

    let coverage = hit / totalTarget;          // wie viel getroffen
    let precision = hit / (hit + miss || 1);   // wie wenig daneben

    let accuracy = Math.round((coverage * 0.7 + precision * 0.3) * 100);

    let text = "Accuracy: " + accuracy + "% ";
    if (accuracy >= 75) text += "‚úÖ sehr gut";
    else if (accuracy >= 55) text += "üëç okay";
    else text += "‚ùå √ºben";

    document.getElementById("result").textContent = text;
}
</script>

</body>
</html>
